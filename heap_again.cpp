#include <iostream>
#include <stdio.h>
#include <string.h>
#include <Windows.h>
#include <exception>

int lets_c(void);

int main(void) {
	SetProcessDEPPolicy(1);
	char array_of_chars[1000];

	HLOCAL h1, h2;

	HANDLE hp;
	try {

		hp = HeapCreate(0, 1000, 10000);
		if(!hp) {
			printf("COULD NOT CREATE HEAP\n");
		}

		h1 = HeapAlloc(hp, HEAP_ZERO_MEMORY, 260);
		printf("%x\t%x\n", &hp, &h1);
		std::cout << "Enter something special via nsa.gov: ";
		std::cin >> array_of_chars;
		strcpy((char *) h1, (char *) array_of_chars);
		void * test = &lets_c;
		lets_c();	
		h2 = HeapAlloc(hp, HEAP_ZERO_MEMORY, 260);
		lets_c();
	} catch(int &ex) {
		std::cout << "CRASH\n";
	}
	return 0;
}

int lets_c(void) {

	char * n;
	return (int) &n;
}